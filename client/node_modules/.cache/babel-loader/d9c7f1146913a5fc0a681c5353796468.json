{"ast":null,"code":"import _slicedToArray from \"/Users/Teva/Desktop/Cleanup/Translator/whatson/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/Teva/Desktop/Cleanup/Translator/whatson/src/pages/MainPage/MainPage.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport Header from '../../components/Header/Header';\nimport Interface from '../../components/Interface/Interface';\nimport Output from '../../components/Output/Output';\nimport LanguageToggle from '../../components/LanguageToggle/LanguageToggle';\nimport MicOn from '../../components/MicOn/MicOn';\nimport MicOff from '../../components/MicOff/MicOff';\nimport { MainPageContainer } from './MainPageStyles';\n\nfunction MainPage() {\n  //state\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        isRecording = _useState2[0],\n        setIsRecording = _useState2[1];\n\n  const _useState3 = useState(''),\n        _useState4 = _slicedToArray(_useState3, 2),\n        text = _useState4[0],\n        setText = _useState4[1];\n\n  const _useState5 = useState(''),\n        _useState6 = _slicedToArray(_useState5, 2),\n        translatedText = _useState6[0],\n        setTranslatedText = _useState6[1];\n\n  const _useState7 = useState('en-US'),\n        _useState8 = _slicedToArray(_useState7, 2),\n        inputLanguage = _useState8[0],\n        setInputLanguage = _useState8[1];\n\n  const _useState9 = useState('en-es'),\n        _useState10 = _slicedToArray(_useState9, 2),\n        outputLanguage = _useState10[0],\n        setOutputLanguage = _useState10[1];\n\n  const _useState11 = useState(''),\n        _useState12 = _slicedToArray(_useState11, 2),\n        temp = _useState12[0],\n        setTemp = _useState12[1]; //fetch this\n\n\n  const IAM_access_token = 'eyJraWQiOiIyMDE5MDcyNCIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLTk2ZDQ3Njc2LTY1ODEtNGE5Ny04YTMxLThiNWQ2ZjNmZTUwMCIsImlkIjoiaWFtLVNlcnZpY2VJZC05NmQ0NzY3Ni02NTgxLTRhOTctOGEzMS04YjVkNmYzZmU1MDAiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC05NmQ0NzY3Ni02NTgxLTRhOTctOGEzMS04YjVkNmYzZmU1MDAiLCJzdWIiOiJTZXJ2aWNlSWQtOTZkNDc2NzYtNjU4MS00YTk3LThhMzEtOGI1ZDZmM2ZlNTAwIiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJ1bmlxdWVfaW5zdGFuY2VfY3JucyI6WyJjcm46djE6Ymx1ZW1peDpwdWJsaWM6c3BlZWNoLXRvLXRleHQ6dXMtc291dGg6YS84NGRhYzYxYWZmMDFkN2MyNGNmMmE5MzQ5ZGU0MDM5YzpjMzhjOGY1Yy01NmE2LTQyMWQtOTM0OS05NGM4YjkxYTNkZjY6OiJdLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI4NGRhYzYxYWZmMDFkN2MyNGNmMmE5MzQ5ZGU0MDM5YyJ9LCJpYXQiOjE1NzMxMDE3NTgsImV4cCI6MTU3MzEwNTM1OCwiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.e6pOZpdpDkRSI744l3SBYROYr_HCv_2M-DGDx5be0UjNNZqMhVrVm_FKEPckdhOylVVdCxkTJqpP7Am4tS7qBbDPwWT3aSgH3RBIXTmFEi3zJkg0qVCc4OmreM_CuSX858x4jXLnVq9wHNnma2ptK1RZVxxwV3QDIo0BjWI3OvdoKTaouTmr7yOBhHwVWCNN0X3UK-dLbKqt8yiva3YSbM5Vg7FsB2hqcz7e3Dfy1ePO5Aar8FOcUgVGHhv6N5mHmk-0D9K8ooUMQ75eYDn7Lp302zt0PDxMCFpqdewkYNcUPIR1IcqIQ_0ZwUBayqcYGfCVa8ylyJsJhmEsUr8YdA';\n  const wsURI = \"wss://stream.watsonplatform.net/speech-to-text/api/v1/recognize?access_token=\".concat(IAM_access_token, \"&model=\").concat(inputLanguage, \"_BroadbandModel\");\n  const websocket = new WebSocket(wsURI);\n\n  websocket.onopen = function (event) {\n    onOpen(event);\n  };\n\n  websocket.onclose = function (event) {\n    onClose(event);\n  };\n\n  websocket.onmessage = function (event) {\n    onMessage(event);\n  };\n\n  websocket.onerror = function (event) {\n    onError(event);\n  };\n\n  function onOpen(evt) {\n    console.log('connecting');\n  }\n\n  function onClose(event) {\n    console.log('closing:', event.data);\n  }\n\n  function onMessage(event) {\n    const data = JSON.parse(event.data);\n\n    if (data.hasOwnProperty('results')) {\n      fetch('http://localhost:3000/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          data: data.results[0].alternatives[0].transcript,\n          outputLanguage\n        })\n      }).then(response => response.json()).then(response => {\n        setText(\"\".concat(text, \" \").concat(data.results[0].alternatives[0].transcript));\n        setTranslatedText(translatedText + response);\n      });\n    }\n  }\n\n  function onError(event) {\n    console.log(event.data);\n  }\n\n  useEffect(() => {\n    const listen = document.querySelector('.startRecording');\n    const stop = document.querySelector('.stopRecording');\n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      console.log('getUserMedia supported.');\n      navigator.mediaDevices.getUserMedia( // constraints - only audio needed for this app\n      {\n        audio: true,\n        sampleSize: 16\n      }) // Success callback\n      .then(function (stream) {\n        const mediaRecorder = new MediaRecorder(stream);\n\n        listen.onclick = function (event) {\n          event.preventDefault();\n\n          if (mediaRecorder.state === 'inactive') {\n            websocket.send(JSON.stringify({\n              action: 'start',\n              'content-type': 'application/octet-stream',\n              \"interim_results\": true\n            }));\n            setIsRecording(true);\n            mediaRecorder.start(1000);\n            console.log(mediaRecorder.state);\n            console.log(\"recorder started\");\n          }\n\n          stop.onclick = function (event) {\n            event.preventDefault();\n\n            if (mediaRecorder.state === 'recording') {\n              setIsRecording(false);\n              mediaRecorder.stop();\n              console.log(mediaRecorder.state);\n              console.log(\"recorder stopped\");\n            }\n          };\n\n          mediaRecorder.ondataavailable = function (event) {\n            websocket.send(event.data);\n          };\n\n          mediaRecorder.onstop = function (event) {\n            websocket.send(JSON.stringify({\n              action: 'stop'\n            }));\n          };\n        };\n      }).catch(function (err) {\n        console.log('The following getUserMedia error occured: ' + err);\n      });\n    } else {\n      console.log('getUserMedia not supported on your browser!');\n    }\n  }, []);\n  return React.createElement(MainPageContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, React.createElement(Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }), React.createElement(Interface, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, React.createElement(LanguageToggle, {\n    heading: \"From\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }), React.createElement(\"img\", {\n    src: \"./images/micOff.png\",\n    alt: \"mic symbol to stop recording\",\n    className: \"stopRecording\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }), React.createElement(\"img\", {\n    src: \"./images/micOn.png\",\n    alt: \"mic symbol to start recording\",\n    className: \"startRecording\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }), React.createElement(LanguageToggle, {\n    heading: \"To\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  })), React.createElement(Output, {\n    originalText: text,\n    translatedText: translatedText,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }));\n}\n\nexport default MainPage;","map":{"version":3,"sources":["/Users/Teva/Desktop/Cleanup/Translator/whatson/src/pages/MainPage/MainPage.jsx"],"names":["React","useState","useEffect","Header","Interface","Output","LanguageToggle","MicOn","MicOff","MainPageContainer","MainPage","isRecording","setIsRecording","text","setText","translatedText","setTranslatedText","inputLanguage","setInputLanguage","outputLanguage","setOutputLanguage","temp","setTemp","IAM_access_token","wsURI","websocket","WebSocket","onopen","event","onOpen","onclose","onClose","onmessage","onMessage","onerror","onError","evt","console","log","data","JSON","parse","hasOwnProperty","fetch","method","headers","body","stringify","results","alternatives","transcript","then","response","json","listen","document","querySelector","stop","navigator","mediaDevices","getUserMedia","audio","sampleSize","stream","mediaRecorder","MediaRecorder","onclick","preventDefault","state","send","action","start","ondataavailable","onstop","catch","err"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nimport Header from '../../components/Header/Header';\nimport Interface from '../../components/Interface/Interface';\nimport Output from '../../components/Output/Output';\nimport LanguageToggle from '../../components/LanguageToggle/LanguageToggle';\nimport MicOn from '../../components/MicOn/MicOn';\nimport MicOff from '../../components/MicOff/MicOff';\n\nimport {\n  MainPageContainer\n} from './MainPageStyles';\n\n\n\nfunction MainPage() {\n  //state\n  const [ isRecording, setIsRecording ] = useState(false)\n  const [ text, setText ] = useState('');\n  const [ translatedText, setTranslatedText ] = useState('');\n  const [ inputLanguage, setInputLanguage ] = useState('en-US');\n  const [ outputLanguage, setOutputLanguage ] = useState('en-es');\n  const [ temp, setTemp ] = useState('');\n\n  //fetch this\n  const IAM_access_token = 'eyJraWQiOiIyMDE5MDcyNCIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLTk2ZDQ3Njc2LTY1ODEtNGE5Ny04YTMxLThiNWQ2ZjNmZTUwMCIsImlkIjoiaWFtLVNlcnZpY2VJZC05NmQ0NzY3Ni02NTgxLTRhOTctOGEzMS04YjVkNmYzZmU1MDAiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC05NmQ0NzY3Ni02NTgxLTRhOTctOGEzMS04YjVkNmYzZmU1MDAiLCJzdWIiOiJTZXJ2aWNlSWQtOTZkNDc2NzYtNjU4MS00YTk3LThhMzEtOGI1ZDZmM2ZlNTAwIiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJ1bmlxdWVfaW5zdGFuY2VfY3JucyI6WyJjcm46djE6Ymx1ZW1peDpwdWJsaWM6c3BlZWNoLXRvLXRleHQ6dXMtc291dGg6YS84NGRhYzYxYWZmMDFkN2MyNGNmMmE5MzQ5ZGU0MDM5YzpjMzhjOGY1Yy01NmE2LTQyMWQtOTM0OS05NGM4YjkxYTNkZjY6OiJdLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI4NGRhYzYxYWZmMDFkN2MyNGNmMmE5MzQ5ZGU0MDM5YyJ9LCJpYXQiOjE1NzMxMDE3NTgsImV4cCI6MTU3MzEwNTM1OCwiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.e6pOZpdpDkRSI744l3SBYROYr_HCv_2M-DGDx5be0UjNNZqMhVrVm_FKEPckdhOylVVdCxkTJqpP7Am4tS7qBbDPwWT3aSgH3RBIXTmFEi3zJkg0qVCc4OmreM_CuSX858x4jXLnVq9wHNnma2ptK1RZVxxwV3QDIo0BjWI3OvdoKTaouTmr7yOBhHwVWCNN0X3UK-dLbKqt8yiva3YSbM5Vg7FsB2hqcz7e3Dfy1ePO5Aar8FOcUgVGHhv6N5mHmk-0D9K8ooUMQ75eYDn7Lp302zt0PDxMCFpqdewkYNcUPIR1IcqIQ_0ZwUBayqcYGfCVa8ylyJsJhmEsUr8YdA'\n\n  const wsURI = `wss://stream.watsonplatform.net/speech-to-text/api/v1/recognize?access_token=${IAM_access_token}&model=${inputLanguage}_BroadbandModel`;\n\n  const websocket = new WebSocket(wsURI);\n  websocket.onopen = function(event) { onOpen(event) };\n  websocket.onclose = function(event) { onClose(event) };\n  websocket.onmessage = function(event) { onMessage(event) };\n  websocket.onerror = function(event) { onError(event) };\n\n  function onOpen(evt) {\n    console.log('connecting')\n  }\n\n  function onClose(event) {\n    console.log('closing:', event.data);\n  }\n  \n  function onMessage(event) {\n    const data = JSON.parse(event.data);\n    if (data.hasOwnProperty('results')) {\n      fetch('http://localhost:3000/', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          data: data.results[0].alternatives[0].transcript,\n          outputLanguage\n        })\n      }).then(response => response.json())\n      .then(response => {\n        setText(`${text} ${data.results[0].alternatives[0].transcript}`)\n        setTranslatedText(translatedText + response)\n      })\n    }\n  }\n  \n  function onError(event) {\n    console.log(event.data);\n  }\n\n  useEffect(() => {\n    \n    const listen = document.querySelector('.startRecording');\n    const stop = document.querySelector('.stopRecording');\n    \n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      console.log('getUserMedia supported.');\n      navigator.mediaDevices.getUserMedia (\n        // constraints - only audio needed for this app\n        { audio: true, sampleSize: 16 })\n  \n        // Success callback\n        .then(function(stream) {\n            const mediaRecorder = new MediaRecorder(stream);\n            listen.onclick = function(event) {\n              event.preventDefault();\n              if (mediaRecorder.state === 'inactive') {\n                websocket.send(JSON.stringify({\n                  action: 'start',\n                  'content-type': 'application/octet-stream',\n                  \"interim_results\": true\n                }));\n                setIsRecording(true);\n                mediaRecorder.start(1000);\n                console.log(mediaRecorder.state);\n                console.log(\"recorder started\");\n              }\n\n              stop.onclick = function(event) {\n                event.preventDefault();\n                if(mediaRecorder.state === 'recording') {\n                  setIsRecording(false)\n                  mediaRecorder.stop();\n                  console.log(mediaRecorder.state);\n                  console.log(\"recorder stopped\");\n                }\n              }\n\n              mediaRecorder.ondataavailable = function(event) {\n                websocket.send(event.data)\n              }\n\n              mediaRecorder.onstop = function(event) {            \n                websocket.send(JSON.stringify({action: 'stop'}))\n              }\n        }})\n        .catch(function(err) {\n            console.log('The following getUserMedia error occured: ' + err);\n        }\n      );\n  } else {\n      console.log('getUserMedia not supported on your browser!');\n  }\n}, [])\n  \n  return (  \n    <MainPageContainer>\n      <Header />\n      <Interface>\n        <LanguageToggle heading=\"From\"/>\n        <img src=\"./images/micOff.png\" alt=\"mic symbol to stop recording\" className=\"stopRecording\"/>\n        <img src=\"./images/micOn.png\" alt=\"mic symbol to start recording\" className=\"startRecording\"/>\n        <LanguageToggle heading=\"To\"/>\n      </Interface>\n      <Output originalText={text} translatedText={translatedText}/>\n    </MainPageContainer>\n  )\n}\n\nexport default MainPage;"]},"metadata":{},"sourceType":"module"}